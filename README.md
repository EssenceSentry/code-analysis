# Python Code Analysis Tools

## Project Goal

This project represents an initial iteration towards building a more comprehensive code analysis framework specifically for Python libraries. The primary objective is to gather detailed contextual information about a codebase. This information will then be used to develop a curated list of scripts and effective prompts to enhance the capabilities of LLM-assisted coding, aiming for more accurate and context-aware suggestions from AI coding assistants.

## Code complexity tools

This project provides a suite of shell scripts to help analyze the complexity of Python code. It includes scripts to install necessary analysis tools, run various complexity metrics, and parse the output into a structured format.

## Features

*   **Tool Installation**: A script ([install_complexity_tools.sh](install_complexity_tools.sh)) to install common Python complexity analysis tools like Radon, McCabe, Flake8, Pygments, complexipy, and cloc on Ubuntu systems.
*   **Code Analysis**: A script ([analyze_python_code.sh](analyze_python_code.sh)) to run these tools on a target Python file or directory. It gathers metrics such as:
    *   Lines of Code (via `cloc`)
    *   Raw metrics (LOC, SLOC, comments, blank lines via `radon raw`)
    *   Cyclomatic Complexity (via `radon cc` and `flake8`)
    *   Maintainability Index (via `radon mi`)
    *   Cognitive Complexity (via `complexipy`)
*   **Output Parsing**: A Python script ([parse_complexity.py](parse_complexity.py)) to parse the text output generated by `analyze_python_code.sh` into a JSON format, separating overall summaries, file-level metrics, and symbol-level metrics. It also generates a file tree of the analyzed project.

## Prerequisites

*   An Ubuntu-based system (for the installation script).
*   Python 3 and pip.
*   `sudo` privileges for installing tools system-wide.

## Setup

1.  **Clone the repository (if applicable) or download the scripts.**
2.  **Make the shell scripts executable:**
    ```bash
    chmod +x install_complexity_tools.sh
    chmod +x analyze_python_code.sh
    ```
3.  **Install the analysis tools:**
    Run the installation script. It will prompt for confirmation before proceeding with system-wide installations.
    ```bash
    ./install_complexity_tools.sh
    ```
    This script prioritizes `apt` for installations and falls back to `pip3 install --break-system-packages` if a tool is not found in `apt` or if `apt` installation fails. Please review the script's warnings and output carefully.

## Usage

### 1. Analyze Python Code

Run the `analyze_python_code.sh` script, providing the path to the Python file or directory you want to analyze.

```bash
./analyze_python_code.sh /path/to/your/python_project_or_file.py > analysis_results.txt
```

*   This will execute various complexity tools and print their output to `stdout`.
*   It's recommended to redirect the output to a file (e.g., `analysis_results.txt`) for later parsing.
*   The script excludes common directories like `.venv`, `.git`, `__pycache__`, etc., by default. You can modify `RADON_EXCLUDE_PATTERNS` and `STANDARD_EXCLUDE_DIRS` within the script if needed.
*   The `FLAKE8_MAX_COMPLEXITY` variable in the script (default is 12) sets the threshold for Flake8's cyclomatic complexity warnings.

### 2. Parse Analysis Results

After generating the `analysis_results.txt` file, you can parse it using the `parse_complexity.py` script.

```bash
python3 parse_complexity.py analysis_results.txt
```

Or, if you made it executable:

```bash
./parse_complexity.py analysis_results.txt
```

*   This script will process the `analysis_results.txt` file and print:
    *   The detected project root path.
    *   An overall summary of metrics in JSON format.
    *   File-level metrics in JSON format.
    *   Symbol-level (function/method) metrics in JSON format.
    *   A file tree of the analyzed project (if the target was a directory).
*   The output is printed to `stdout`, which you can redirect to a JSON file if desired:
    ```bash
    python3 parse_complexity.py analysis_results.txt > parsed_metrics.json
    ```

## Scripts Overview

### `install_complexity_tools.sh`

*   Installs `radon`, `mccabe`, `flake8`, `Pygments`, `complexipy`, and `cloc`.
*   Attempts `apt` installation first, then `pip3` with `--break-system-packages` as a fallback.
*   Requires `sudo` access.

### `analyze_python_code.sh`

*   Takes a Python file or directory path as an argument.
*   Runs `cloc`, `radon` (raw, cc, mi), `flake8` (for complexity), and `complexipy`.
*   Outputs raw tool results to `stdout`.
*   Key configurable variables: `FLAKE8_MAX_COMPLEXITY`, `RADON_EXCLUDE_PATTERNS`, `STANDARD_EXCLUDE_DIRS`.

### `parse_complexity.py`

*   Takes the output file from `analyze_python_code.sh` as an argument.
*   Parses the text using regular expressions defined at the top of the script (e.g., [`TARGET_PATH_RE`](parse_complexity.py), [`RADON_RAW_FILE_BLOCK_RE`](parse_complexity.py), etc.).
*   Normalizes file paths and aggregates data.
*   Outputs structured JSON data and a project file tree.
*   Includes functions like [`parse_radon_raw_section()`](parse_complexity.py), [`parse_radon_cc_section()`](parse_complexity.py), [`parse_radon_mi_section()`](parse_complexity.py), [`parse_flake8_section()`](parse_complexity.py), [`parse_complexipy_section()`](parse_complexity.py), and [`generate_file_tree()`](parse_complexity.py).

## Customization

*   **Analysis Script (`analyze_python_code.sh`):**
    *   Modify `FLAKE8_MAX_COMPLEXITY` to change the cyclomatic complexity threshold for Flake8.
    *   Adjust `RADON_EXCLUDE_PATTERNS` and `STANDARD_EXCLUDE_DIRS` to customize excluded paths for different tools.
*   **Parsing Script (`parse_complexity.py`):**
    *   The regular expressions at the beginning of the script are crucial for parsing. If the output format of the underlying tools changes, these regexes might need updates.
    *   The [`get_custom_mi_rank()`](parse_complexity.py) function defines custom ranking for Maintainability Index scores; this can be adjusted to your preferences.

## Contributing

Feel free to fork the project, submit issues, or suggest improvements.
```// filepath: README.md
# Python Code Complexity Analysis Tools

This project provides a suite of shell scripts to help analyze the complexity of Python code. It includes scripts to install necessary analysis tools, run various complexity metrics, and parse the output into a structured format.

## Features

*   **Tool Installation**: A script ([install_complexity_tools.sh](install_complexity_tools.sh)) to install common Python complexity analysis tools like Radon, McCabe, Flake8, Pygments, complexipy, and cloc on Ubuntu systems.
*   **Code Analysis**: A script ([analyze_python_code.sh](analyze_python_code.sh)) to run these tools on a target Python file or directory. It gathers metrics such as:
    *   Lines of Code (via `cloc`)
    *   Raw metrics (LOC, SLOC, comments, blank lines via `radon raw`)
    *   Cyclomatic Complexity (via `radon cc` and `flake8`)
    *   Maintainability Index (via `radon mi`)
    *   Cognitive Complexity (via `complexipy`)
*   **Output Parsing**: A Python script ([parse_complexity.py](parse_complexity.py)) to parse the text output generated by `analyze_python_code.sh` into a JSON format, separating overall summaries, file-level metrics, and symbol-level metrics. It also generates a file tree of the analyzed project.

## Prerequisites

*   An Ubuntu-based system (for the installation script).
*   Python 3 and pip.
*   `sudo` privileges for installing tools system-wide.

## Setup

1.  **Clone the repository (if applicable) or download the scripts.**
2.  **Make the shell scripts executable:**
    ```bash
    chmod +x install_complexity_tools.sh
    chmod +x analyze_python_code.sh
    ```
3.  **Install the analysis tools:**
    Run the installation script. It will prompt for confirmation before proceeding with system-wide installations.
    ```bash
    ./install_complexity_tools.sh
    ```
    This script prioritizes `apt` for installations and falls back to `pip3 install --break-system-packages` if a tool is not found in `apt` or if `apt` installation fails. Please review the script's warnings and output carefully.

## Usage

### 1. Analyze Python Code

Run the `analyze_python_code.sh` script, providing the path to the Python file or directory you want to analyze.

```bash
./analyze_python_code.sh /path/to/your/python_project_or_file.py > analysis_results.txt
```

*   This will execute various complexity tools and print their output to `stdout`.
*   It's recommended to redirect the output to a file (e.g., `analysis_results.txt`) for later parsing.
*   The script excludes common directories like `.venv`, `.git`, `__pycache__`, etc., by default. You can modify `RADON_EXCLUDE_PATTERNS` and `STANDARD_EXCLUDE_DIRS` within the script if needed.
*   The `FLAKE8_MAX_COMPLEXITY` variable in the script (default is 12) sets the threshold for Flake8's cyclomatic complexity warnings.

### 2. Parse Analysis Results

After generating the `analysis_results.txt` file, you can parse it using the `parse_complexity.py` script.

```bash
python3 parse_complexity.py analysis_results.txt
```

Or, if you made it executable:

```bash
./parse_complexity.py analysis_results.txt
```

*   This script will process the `analysis_results.txt` file and print:
    *   The detected project root path.
    *   An overall summary of metrics in JSON format.
    *   File-level metrics in JSON format.
    *   Symbol-level (function/method) metrics in JSON format.
    *   A file tree of the analyzed project (if the target was a directory).
*   The output is printed to `stdout`, which you can redirect to a JSON file if desired:
    ```bash
    python3 parse_complexity.py analysis_results.txt > parsed_metrics.json
    ```

## Scripts Overview

### `install_complexity_tools.sh`

*   Installs `radon`, `mccabe`, `flake8`, `Pygments`, `complexipy`, and `cloc`.
*   Attempts `apt` installation first, then `pip3` with `--break-system-packages` as a fallback.
*   Requires `sudo` access.

### `analyze_python_code.sh`

*   Takes a Python file or directory path as an argument.
*   Runs `cloc`, `radon` (raw, cc, mi), `flake8` (for complexity), and `complexipy`.
*   Outputs raw tool results to `stdout`.
*   Key configurable variables: `FLAKE8_MAX_COMPLEXITY`, `RADON_EXCLUDE_PATTERNS`, `STANDARD_EXCLUDE_DIRS`.

### `parse_complexity.py`

*   Takes the output file from `analyze_python_code.sh` as an argument.
*   Parses the text using regular expressions defined at the top of the script (e.g., [`TARGET_PATH_RE`](parse_complexity.py), [`RADON_RAW_FILE_BLOCK_RE`](parse_complexity.py), etc.).
*   Normalizes file paths and aggregates data.
*   Outputs structured JSON data and a project file tree.
*   Includes functions like [`parse_radon_raw_section()`](parse_complexity.py), [`parse_radon_cc_section()`](parse_complexity.py), [`parse_radon_mi_section()`](parse_complexity.py), [`parse_flake8_section()`](parse_complexity.py), [`parse_complexipy_section()`](parse_complexity.py), and [`generate_file_tree()`](parse_complexity.py).

## Customization

*   **Analysis Script (`analyze_python_code.sh`):**
    *   Modify `FLAKE8_MAX_COMPLEXITY` to change the cyclomatic complexity threshold for Flake8.
    *   Adjust `RADON_EXCLUDE_PATTERNS` and `STANDARD_EXCLUDE_DIRS` to customize excluded paths for different tools.
*   **Parsing Script (`parse_complexity.py`):**
    *   The regular expressions at the beginning of the script are crucial for parsing. If the output format of the underlying tools changes, these regexes might need updates.
    *   The [`get_custom_mi_rank()`](parse_complexity.py) function defines custom ranking for Maintainability Index scores; this can be adjusted to your preferences.

## Contributing

Feel free to fork the project, submit issues, or